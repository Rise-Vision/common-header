<!-- Step 4 -->
<div id="checkout-payment-methods">
  <form id="form.paymentMethodsForm" role="form" class="u_margin-md-top" name="form.paymentMethodsForm" novalidate>
    <!-- Alpha Release - Select New Card by default -->
    <div class="row u_margin-md-top" ng-if="false">
      <div class="col-md-8 col-xs-12 form-inline">
        <div class="form-group">
          <label for="payment-method-select" class="u_margin-right">Payment Method</label>
          <select id="payment-method-select" class="form-control selectpicker" ng-model="plan.paymentMethods.paymentMethod">
            <option value="card">Credit Card</option>
            <option value="invoice">Invoice Me</option>
          </select>
        </div>
      </div>
    </div>
    <hr ng-if="false" />

    <div id="credit-card-form" ng-if="plan.paymentMethods.paymentMethod === 'card'">
      <!-- Alpha Release - Select New Card by default -->
      <div class="row" ng-if="false">
        <div class="col-md-12">
          <div class="form-group">
            <select id="credit-card-select" class="form-control selectpicker" ng-model="plan.paymentMethods.selectedCard" ng-options="c as getCardDescription(c) for c in plan.paymentMethods.existingCreditCards track by c.id">
              <option value="">Add New Credit Card</option>
            </select>
          </div>
        </div>
      </div>

      <!-- NEW CREDIT CARD -->
      <div id="new-credit-card-form" ng-if="!plan.paymentMethods.selectedCard">
        <div class="alert alert-danger" ng-show="form.paymentMethodsForm.$submitted && form.paymentMethodsForm.$invalid">
          Please complete the missing information below.
        </div>
        <div id="errorBox" class="alert alert-danger" role="alert" ng-show="plan.paymentMethods.newCreditCard.validationErrors.length">
          <strong>Card Validation Error(s)</strong>
          <ul>
            <li ng-repeat="error in plan.paymentMethods.newCreditCard.validationErrors">{{error}}</li>
          </ul>
        </div>
        <div id="errorBox" class="alert alert-danger" role="alert" ng-show="plan.paymentMethods.newCreditCard.tokenError">
          <strong>Card Processing Error</strong> {{plan.paymentMethods.newCreditCard.tokenError}}
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group" ng-class="{ 'has-error': (form.paymentMethodsForm.cardholderName.$dirty || form.paymentMethodsForm.$submitted) && form.paymentMethodsForm.cardholderName.$invalid }">
              <label for="new-card-name" lass="control-label">Cardholder Name</label>
              <input id="new-card-name" type="text" class="form-control" name="cardholderName" data-stripe="name" ng-model="plan.paymentMethods.newCreditCard.name" autocomplete="cc-name" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="form-group" ng-class="{ 'has-error': (form.paymentMethodsForm.cardNumber.$dirty || form.paymentMethodsForm.$submitted) && form.paymentMethodsForm.cardNumber.$invalid }">
              <label for="new-card-number" class="control-label">Card Number</label>
              <input id="new-card-number" type="text" class="form-control" placeholder="0000 0000 0000 0000" name="cardNumber"  data-stripe="number" ng-model="plan.paymentMethods.newCreditCard.number" autocomplete="cc-number" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <div class="form-group" ng-class="{ 'has-error': (form.paymentMethodsForm.cardExpiryMonth.$dirty || form.paymentMethodsForm.$submitted) && form.paymentMethodsForm.cardExpiryMonth.$invalid }">
              <label for="new-card-expiry-month" class="control-label">Expiry Month</label>
              <select id="new-card-expiry-month" class="form-control" name="cardExpiryMonth" data-stripe="exp-month" ng-model="plan.paymentMethods.newCreditCard.expMonth" autocomplete="cc-exp-month" integer-parser required>
                <option ng-show="false" value="">&lt; Select Month &gt;</option>
                <option value="1">01</option>
                <option value="2">02</option>
                <option value="3">03</option>
                <option value="4">04</option>
                <option value="5">05</option>
                <option value="6">06</option>
                <option value="7">07</option>
                <option value="8">08</option>
                <option value="9">09</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group" ng-class="{ 'has-error': (form.paymentMethodsForm.cardExpiryYear.$dirty || form.paymentMethodsForm.$submitted) && form.paymentMethodsForm.cardExpiryYear.$invalid }">
              <label for="expiry-year" class="control-label">Expiry Year</label>
              <year-selector id="new-card-expiry-year" class="form-control" name="cardExpiryYear" data-stripe="exp-year" ng-model="plan.paymentMethods.newCreditCard.expYear" autocomplete="cc-exp-month" integer-parser required>
              </year-selector>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group" ng-class="{ 'has-error': (form.paymentMethodsForm.cardCvc.$dirty || form.paymentMethodsForm.$submitted) && form.paymentMethodsForm.cardCvc.$invalid }">
              <label for="new-card-cvc" class="control-label">Security Code</label>
              <input id="new-card-cvc" type="number" class="form-control" name="cardCvc" data-stripe="cvc" ng-model="plan.paymentMethods.newCreditCard.cvc" autocomplete="cc-csc" maxlength="4" required>
            </div>
          </div>
        </div>

        <div class="checkbox">
          <label>
            <input type="checkbox" id="toggleMatchBillingAddress" ng-model="plan.paymentMethods.newCreditCard.useBillingAddress">
            Same As Billing Address
          </label>
        </div>

        <!-- NEW CC ADDRESS -->
        <div id="new-card-address">

          <address-form form-object="form.paymentMethodsForm" address-object="plan.paymentMethods.newCreditCard.address" hide-company-name="true" ng-if="!plan.paymentMethods.newCreditCard.useBillingAddress"></address-form>

        </div>
        <!--  END NEW CC ADDRESS -->
      </div>
      <!-- END NEW CC -->

      <!-- EXISTING CREDIT CARD -->
      <div id="existing-credit-card-form" ng-if="plan.paymentMethods.selectedCard">
        <div id="errorBox" class="alert alert-danger" role="alert" ng-show="plan.paymentMethods.selectedCard.validationErrors.length">
          <strong>Card Validation Error</strong> {{plan.paymentMethods.selectedCard.validationErrors[0]}}
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="existing-card-name" class="control-label">Cardholder Name</label>
              <input id="existing-card-name" type="text" class="form-control" placeholder="{{plan.paymentMethods.selectedCard.name}}" disabled="disabled">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="existing-card-number" class="control-label">Card Number</label>
              <input id="existing-card-number" type="text" class="form-control" placeholder="{{plan.paymentMethods.selectedCard.last4 | cardLastFour}}" disabled="disabled" />
            </div>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-4">
            <div class="form-group">
              <label for="existing-card-expiry-month" class="control-label">Expiry Month</label>
              <input id="existing-card-expiry-month" type="text" class="form-control masked"  placeholder="{{plan.paymentMethods.selectedCard.expMonth | paddedMonth}}" disabled="disabled" />
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label for="existing-card-expiry-year" class="control-label">Expiry Year</label>
              <input id="existing-card-expiry-year" type="text" class="form-control masked"  placeholder="{{plan.paymentMethods.selectedCard.expYear}}" disabled="disabled" />
            </div>
          </div>          
        </div>
      </div>
      <!-- END EXISTING CC -->
    </div>

    <!-- //GENERATE INVOICE FORM -->
    <div id="generateInvoice" ng-if="plan.paymentMethods.paymentMethod === 'invoice'">
      <p>If you'd like to be invoiced for your purchase (rather than paying now by credit card), please enter a <b>Purchase Order</b> number
        and continue with checkout.</p>
      <p>You will receive an invoice for this purchase total at <b>user@domain.com</b>. Invoices are due within 30 days of creation, payable by check, wire transfer, or credit card.</p>
      <p>Please note your invoice is generated only once this checkout is completed.</p>

      <div class="row">
          <div class="col-xs-12 col-sm-6">
            <div class="form-group"><label class="control-label" id="triggerOverdue"> Purchase Order Number </label>
              <input type="text" class="form-control" placeholder="" />
            </div>
          </div>
      </div>

      <div id="generateInvoiceOverdue" style="display:none">
          <p class="text-danger">You have overdue invoice payments on your account.</p>
          <p>In order to complete this purchase by invoice, please pay your outstanding invoices <a href="#">here</a>.</p>
      </div>
    </div>

    <hr>
    <div class="row">
      <div class="col-xs-12">
        <button id="backButton" type="button" class="btn btn-default btn-lg pull-left" ng-click="setPreviousStep()" translate>common.back</button>
        <button id="continueButton" type="submit" form="form.paymentMethodsForm" class="btn btn-primary btn-lg pull-right" ng-click="validatePaymentMethod(plan.paymentMethods)" translate>common.continue</button>
      </div>
    </div>
  </form>

</div>
