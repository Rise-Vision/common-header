"use strict";angular.module("risevision.common.apis",["risevision.common.gapi"]).factory("listApis",["$q","discoveryAPILoader","$log",function(e,r,t){return function(n,o){t.debug("listApis called",n,o);var i=e.defer();return r().then(function(e){var r={};n&&(r.name=n),o&&(r.preferred=o);var a=e.apis.list(r);a.execute(function(e){t.debug("listApis resp",e),e.result?i.resolve(e.items):i.reject(e)})}),i.promise}}]).factory("getRest",["$q","discoveryAPILoader","$log",function(e,r,t){return function(n,o){t.debug("getRest called",n,o);var i=e.defer();return r().then(function(e){var r={};n&&(r.api=n),o&&(r.version=o);var a=e.apis.getRest(r);a.execute(function(e){t.debug("getRest resp",e),e.result?i.resolve(e):i.reject(e)})}),i.promise}}]),angular.module("risevision.common.app",["risevision.common.gapi","risevision.core.util"]).constant("APP_WRITABLE_FIELDS",["name","description","clientId","url"]).factory("listApps",["$q","riseAPILoader","$log",function(e,r,t){return function(n){t.debug("listApps called",n);var o=e.defer();return r().then(function(e){var r={};n&&(r.companyId=n);var i=e.app.list(r);i.execute(function(e){t.debug("listApps resp",e),e.result?o.resolve(e.items):o.reject(e)})}),o.promise}}]).factory("getApp",["$q","riseAPILoader","$log",function(e,r,t){return function(n){t.debug("getApp called",n);var o=e.defer();return r().then(function(e){var r={};n&&(r.id=n);var i=e.app.get(r);i.execute(function(e){t.debug("getApp resp",e),e.result?o.resolve(e.item):o.reject(e)})}),o.promise}}]).factory("createApp",["$q","riseAPILoader","$log","pick","APP_WRITABLE_FIELDS",function(e,r,t,n,o){return function(i,a,u){t.debug("createApp called",i,a,u);var s=e.defer();return r().then(function(e){var r=n.apply(this,[u].concat(o)),t=e.app.add({companyId:i,userId:a,data:JSON.stringify(r)});t.execute(function(e){e.result?s.resolve(e.item):s.reject(e)},s.reject)}),s.promise}}]).factory("updateApp",["$q","riseAPILoader","$log","pick","APP_WRITABLE_FIELDS",function(e,r,t,n,o){return function(i,a){t.debug("updateApp called",i,a);var u=e.defer();return r().then(function(e){var r=n.apply(this,[a].concat(o)),t=e.app.update({id:i,data:JSON.stringify(r)});t.execute(function(e){e.result?u.resolve(e.item):u.reject(e)},u.reject)}),u.promise}}]).factory("deleteApp",["$q","riseAPILoader","$log",function(e,r,t){return function(n){t.debug("deleteApp called",n);var o=e.defer();return r().then(function(e){var r={};n&&(r.id=n);var i=e.app["delete"](r);i.execute(function(e){t.debug("deleteApp resp",e),e.result?o.resolve(e.item):o.reject(e)})}),o.promise}}]),function(e){e.module("risevision.core.cache",[]).factory("userInfoCache",["$cacheFactory",function(e){return e("user-info-cache")}])}(angular),angular.module("risevision.common.core.endpoint",["risevision.common.gapi"]).factory("callEndpoint",["coreAPILoader","$q","$log",function(coreAPILoader,$q,$log){return function(method,criteria){$log.debug("Endpoint called",method,criteria);var deferred=$q.defer();return coreAPILoader().then(function(core){var request=eval(method)(criteria);request.execute(function(e){$log.debug("Endpoint resp",e),e.result?deferred.resolve(e):deferred.reject(e)})}),deferred.promise}}]),function(e){e.module("risevision.core.company",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).constant("COMPANY_WRITABLE_FIELDS",["name","street","unit","city","province","country","postalCode","timeZoneOffset","telephone","fax","companyStatus","mailSyncEnabled","sellerId","isTest","shipToUseCompanyAddress","shipToName","shipToStreet","shipToUnit","shipToCity","shipToProvince","shipToPostalCode","shipToCountry","website","companySize","companyIndustry"]).constant("ALERTS_WRITABLE_FIELDS",["alertSettings"]).constant("COMPANY_SEARCH_FIELDS",["name","id","street","unit","city","province","country","postalCode","telephone","fax","shipToName","shipToStreet","shipToCity","shipToPostalCode"]).factory("company",["$q","$log","coreAPILoader","pick","ALERTS_WRITABLE_FIELDS",function(e,r,t,n,o){var i={updateAlerts:function(i,a){var u=e.defer(),s=n.apply(this,[a].concat(o)),c={id:i,data:s};return r.debug("updateAlerts called",i,s),t().then(function(e){return e.company.patch(c)}).then(function(e){r.debug("update Alerts resp",e),u.resolve(e.result)}).then(null,function(e){r.error("Failed to update Alerts.",e),u.reject(e)}),u.promise}};return i}]).factory("createCompany",["$q","coreAPILoader","COMPANY_WRITABLE_FIELDS","pick",function(e,r,t,n){return function(o,i){var a=e.defer();return r().then(function(e){var r=n.apply(this,[i].concat(t)),u=e.company.add({parentId:o,data:r});u.execute(function(e){e.result?a.resolve(e.item):a.reject(e)},a.reject)}),a.promise}}]).factory("getCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(n){t.debug("getCompany called",n);var o=r.defer();return e().then(function(e){var r={};n&&(r.id=n);var i=e.company.get(r);i.execute(function(e){t.debug("getCompany resp",e),e.result?o.resolve(e.item):o.reject(e)})}),o.promise}}]).factory("lookupCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(n){t.debug("lookupCompany called",n);var o=r.defer();return e().then(function(e){var r=e.company.lookup({authKey:n});r.execute(function(e){t.debug("lookupCompany resp",e),e.result?o.resolve(e.item):o.reject(e)})}),o.promise}}]).factory("moveCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(n,o){var i=r.defer();return e().then(function(e){var r=e.company.move({authKey:n,newParentId:o});r.execute(function(e){t.debug("moveCompany resp",e),e.result?i.resolve(e.item):i.reject(e)})}),i.promise}}]).factory("updateCompany",["$q","$log","coreAPILoader","pick","COMPANY_WRITABLE_FIELDS",function(e,r,t,n,o){return function(i,a){var u=e.defer();return a=n.apply(this,[a].concat(o)),r.debug("updateCompany called",i,a),t().then(function(e){var t=e.company.patch({id:i,data:a});t.execute(function(e){r.debug("updateCompany resp",e),e.result?u.resolve(e):u.reject(e)})}),u.promise}}]).factory("regenerateCompanyField",["$q","$log","coreAPILoader",function(e,r,t){return function(n,o){var i=e.defer();return r.debug("regenerateField called",n,o),t().then(function(e){var t=e.company.regenerateField({id:n,fieldName:o});t.execute(function(e){r.debug("regenerateField resp",e),e.error?i.reject(e.message):i.resolve(e)},function(e){i.reject("call failed "+e)})}),i.promise}}]).factory("deleteCompany",["coreAPILoader","$q","$log",function(e,r,t){return function(n){t.debug("deleteCompany called",n);var o=r.defer();return e().then(function(e){var r={};n&&(r.id=n);var i=e.company["delete"](r);i.execute(function(e){t.debug("deleteCompany resp",e),e.result?o.resolve(e.item):o.reject(e)})}),o.promise}}]).service("companyService",["coreAPILoader","$q","$log","getCompany","COMPANY_SEARCH_FIELDS",function(e,r,t,n,o){var i=function(e,r){for(var t="",n=0;n<e.length;n++)t+="OR "+e[n]+":~'"+r+"' ";return t=t?t.substring(3):"",t.trim()};this.getCompanies=function(n,a,u,s,c){var l=r.defer(),d=a?i(o,a):"",p={companyId:n,search:d,cursor:u,count:s,sort:c};return t.debug("getCompanies called with",p),e().then(function(e){var r=e.company.list(p);r.execute(function(e){t.debug("getCompanies resp",e),l.resolve(e)})}),l.promise},this.loadSelectedCompany=function(e,t){var o=r.defer();return e&&e!==t.id?n(e).then(function(e){0===e.code&&e.item?o.resolve(e.item):o.resolve(t)}):o.resolve(t),o.promise}}]).filter("fullAddress",function(){return function(e){var r=(e.street?e.street+", ":"")+(e.city?e.city+", ":"")+(e.province?e.province+", ":"")+(e.country?e.country+", ":"")+(e.postalCode?e.postalCode+", ":"");return r&&(r=r.substr(0,r.length-2)),r}})}(angular),function(e){e.module("risevision.core.util",[]).factory("pick",function(){var r=Array.prototype,t=r.slice,n=r.concat,o=function(e,r,t){if(void 0===r)return e;switch(null===t?3:t){case 1:return function(t){return e.call(r,t)};case 2:return function(t,n){return e.call(r,t,n)};case 3:return function(t,n,o){return e.call(r,t,n,o)};case 4:return function(t,n,o,i){return e.call(r,t,n,o,i)}}return function(){return e.apply(r,arguments)}};return function(r,i,a){var u,s={};if(null===r)return s;if(e.isFunction(i)){i=o(i,a);for(u in r){var c=r[u];i(c,u,r)&&(s[u]=c)}}else{var l=n.apply([],t.call(arguments,1));r=new Object(r);for(var d=0,p=l.length;d<p;d++)u=l[d],u in r&&(s[u]=r[u])}return s}})}(angular),function(e){e.module("risevision.core.countries",["risevision.common.gapi"]).factory("getCoreCountries",["coreAPILoader","$q","$log","$filter",function(e,r,t,n){var o;return function(){return o?o.promise:(o=r.defer(),e().then(function(e){return e.country.list()}).then(function(e){var r=e.result?e.result.items:[];r instanceof Array&&(r=n("orderBy")(r,"name")),o.resolve(r)}).then(null,function(e){t.debug("getCoreCountries failed",e),o.reject(e),o=null}),o.promise)}}]).factory("COUNTRIES",["getCoreCountries",function(e){var r=[];return e().then(function(e){Array.prototype.push.apply(r,e)}),r}])}(angular),function(e){e.module("risevision.core.display",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).service("displayService",["coreAPILoader","$q","$log",function(e,r,t){this.list=function(n,o,i,a,u){var s=r.defer(),c={companyId:n,search:o,cursor:i,count:a,sort:u};return t.debug("list displays called with",c),e().then(function(e){var r=e.display.list(c);r.execute(function(e){t.debug("list displays resp",e),e.result?s.resolve(e.items):s.reject(e)})}),s.promise}}])}(angular),angular.module("risevision.common.fastpass",[]).factory("loadFastpass",["$q","$http","$document","$timeout","GSFP_URL","$log",function(e,r,t,n,o,i){var a=function(r){var n=e.defer(),o=t[0].createElement("script");return o.onload=o.onreadystatechange=function(e){n.resolve(e)},o.onerror=function(e){n.reject(e)},o.src=r,t[0].body.appendChild(o),n.promise};return function(t,n){var u=e.defer();i.debug("loadFastpass called",t,n);var s=function(e){i.error("loadFastpass rejected",e),u.reject("loadFastpass rejected "+e)};return r.get(o+"/geturl?userEmail="+n+"&userName="+t).then(function(e){a(e.data).then(function(e){i.debug("loadFastpass result",e),u.resolve(!0)},s)["catch"](s)},u.reject),u.promise}}]),angular.module("risevision.common.monitoring.activity",["risevision.common.gapi"]).factory("getActivity",["$q","monitoringAPILoader","$log",function(e,r,t){return function(n,o){t.debug("getActivity called",n,o);var i=e.defer();return r().then(function(e){var r={};n&&(r.clientId=n),o&&(r.api=o);var a=e.activity.get(r);a.execute(function(e){t.debug("getActivity resp",e),e.result?i.resolve(e.result):i.reject(e)})},function(e){t.debug("Error: "+e),i.reject(e)}),i.promise}}]),function(e){e.module("risevision.core.oauth2",["risevision.common.gapi","risevision.core.cache"]).factory("getOAuthUserInfo",["oauth2APILoader","$q","userInfoCache","$log",function(e,r,t,n){return function(){var o,i=r.defer();return(o=t.get("oauth2UserInfo"))?o.error?i.reject(o.error):i.resolve(o):e().then(function(e){e.userinfo.get().execute(function(e){n.debug("getOAuthUserInfo oauth2.userinfo.get() resp",e),e?e.hasOwnProperty("error")?(t.remove("oauth2UserInfo"),i.reject(e.error)):(t.put("oauth2UserInfo",e),i.resolve(e)):(t.remove("oauth2UserInfo"),i.reject())})},i.reject),i.promise}}])}(angular),function(e){e.module("risevision.core.schedule",["risevision.common.gapi","risevision.core.cache","risevision.core.util"]).service("scheduleService",["coreAPILoader","$q","$log",function(e,r,t){this.list=function(n,o,i,a,u){var s=r.defer(),c={companyId:n,search:o,cursor:i,count:a,sort:u};return t.debug("getSchedules called with",c),e().then(function(e){var r=e.schedule.list(c);r.execute(function(e){t.debug("getSchedules resp",e),e.result?s.resolve(e.items):s.reject(e)})}),s.promise}}])}(angular),function(){angular.module("risevision.common.subscription-status",["risevision.common.gapi"]).service("subscriptionStatusService",["$http","$q","storeAPILoader","$log",function(e,r,t,n){function o(e,r){return Math.floor((r.getTime()-e.getTime())/u)}var i=["On Trial","Trial Expired","Subscribed","Suspended","Cancelled","Free","Not Subscribed","Product Not Found","Company Not Found","Error"],a=["on-trial","trial-expired","subscribed","suspended","cancelled","free","not-subscribed","product-not-found","company-not-found","error"],u=864e5;this.get=function(e,u){var s=r.defer(),c={companyId:u,productCodes:e};return t().then(function(e){var r=e.product.status(c);r.execute(function(e){if(n.debug("getProductStatus resp",e),e.result){var r=e.items[0];r.plural="";var t=i.indexOf(r.status);t>=0&&(r.statusCode=a[t]),""===r.status?(r.status="N/A",r.statusCode="na",r.subscribed=!1):r.status===i[0]||r.status===i[2]||r.status===i[5]?r.subscribed=!0:r.subscribed=!1,"not-subscribed"===r.statusCode&&r.trialPeriod&&r.trialPeriod>0&&(r.statusCode="trial-available",r.subscribed=!0),r.expiry&&"on-trial"===r.statusCode&&(r.expiry=new Date(r.expiry),r.expiry instanceof Date&&!isNaN(r.expiry.valueOf())&&(r.expiry=o(new Date,r.expiry)),0===r.expiry?r.plural="-zero":r.expiry>1&&(r.plural="-many")),s.resolve(r)}else s.reject(e)})}),s.promise}}])}(),function(e){e.module("risevision.core.systemmessages",["risevision.common.gapi"]).factory("getCoreSystemMessages",["gapiLoader","$q","$log",function(e,r,t){return function(n){var o=r.defer();return e().then(function(e){var r=e.client.core.systemmessage.list({companyId:n});r.execute(function(e){var r=e;r instanceof Array||!r.items||(r=r.items),t.debug("getCoreSystemMessage resp",r),o.resolve(r)})}),o.promise}}])}(angular),function(e){e.module("risevision.core.userprofile",["risevision.common.gapi","risevision.core.oauth2"]).value("userRoleMap",{ce:"Content Editor",cp:"Content Publisher",da:"Display Administrator",ua:"System Administrator",pu:"Store Purchaser",sa:"Rise System Administrator",ba:"Rise Store Administrator"}).constant("USER_WRITABLE_FIELDS",["mailSyncEnabled","email","firstName","lastName","telephone","roles","status","companyRole","dataCollectionDate"]).factory("getUserProfile",["oauth2APILoader","coreAPILoader","$q","$log",function(e,r,t,n){var o,i={};return function(a,u){var s;if(a===o&&!u&&null!==i[a])return i[a].promise;if(o=a,i[a]=s=t.defer(),a){var c={};a&&(c.username=a),n.debug("getUserProfile called",c),t.all([e(),r()]).then(function(e){var r=e[1];r.user.get(c).execute(function(e){e.error||!e.result?s.reject(e):(n.debug("getUser resp",e),s.resolve(e.item))})},s.reject)}else s.reject("getUserProfile failed: username param is required."),n.debug("getUserProfile failed: username param is required.");return s.promise}}]).factory("updateUser",["$q","coreAPILoader","$log","getUserProfile","pick","USER_WRITABLE_FIELDS",function(e,r,t,n,o,i){return function(a,u){var s=e.defer();return u=o(u,i),t.debug("updateUser called",a,u),r().then(function(e){var r=e.user.patch({username:a,data:u});r.execute(function(e){t.debug("updateUser resp",e),e.error?s.reject(e):e.result?n(a,!0).then(function(){s.resolve(e)}):s.reject("updateUser")})},s.reject),s.promise}}]).factory("addUser",["$q","coreAPILoader","$log","pick","getUserProfile",function(e,r,t,n,o){return function(i,a,u){var s=e.defer();return r().then(function(e){u=n(u,"mailSyncEnabled","email","firstName","lastName","telephone","roles","status");var r=e.user.add({username:a,companyId:i,data:u});r.execute(function(e){t.debug("addUser resp",e),e.result?o(a,!0).then(function(){s.resolve(e)}):s.reject(e)})}),s.promise}}]).factory("deleteUser",["$q","coreAPILoader","$log",function(e,r,t){return function(n){var o=e.defer();return r().then(function(e){var r=e.user["delete"]({username:n});r.execute(function(e){t.debug("deleteUser resp",e),e.result?o.resolve(e):o.reject("deleteUser")})}),o.promise}}]).factory("getUsers",["$q","coreAPILoader","$log",function(e,r,t){return function(n){t.debug("getUsers",n);var o=e.defer();return r().then(function(e){var r=e.user.list(n);r.execute(function(e){t.debug("getUsers resp",e),e.result?o.resolve(e.items):o.reject("getUsers")})},o.reject),o.promise}}])}(angular);