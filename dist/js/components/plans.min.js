"use strict";angular.module("risevision.common.components.plans.services",["risevision.common.gapi","risevision.common.currency"]),angular.module("risevision.common.components.plans",["risevision.common.components.plans.services","risevision.common.components.scrolling-list","risevision.common.components.loading","ui.bootstrap"]),function(e){e.module("risevision.common.currency",["risevision.common.gapi"]).factory("currencyService",["$q","storeAPILoader","$log",function(e,t,n){var a=null,s={defaultItem:null},r=function(e){this.country=e.country,this.currencyCode=e.currencyCode,this.description=e.description,this.bankAccountCode=e.bankAccountCode,this.bankAccountDescription=e.bankAccountDescription,this.getName=function(){return this.currencyCode.toUpperCase()},this.pickPrice=function(e,t){switch(this.currencyCode.toUpperCase()){case"CAD":return t;default:return e}}};return s.getByCountry=function(e){if(e)for(var t=0;t<this.items.length;t++)if(this.items[t].country&&this.items[t].country.toUpperCase()===e.toUpperCase())return this.items[t];return this.defaultItem},s.setItems=function(e){this.items=[];for(var t=0;t<e.length;t++){var n=new r(e[t]);this.items.push(n),n.country||(this.defaultItem=n)}},function(){return null!==a?a.promise:(a=e.defer(),n.debug("currencyService called"),t().then(function(e){var t=e.currency.list();t.execute(function(e){n.debug("currencyService resp",e),e.error?(console.error("currencyService error: ",e.error),a.reject(e.error)):(s.setItems(e.items),a.resolve(s))})}),a.promise)}}])}(angular),function(e){e.module("risevision.common.components.plans").value("PLANS_LIST",[{name:"Free",type:"free",productId:"000",pc:"000",status:"Subscribed",priceMonth:0,descriptionShort:"Design, distribute and manage your digital signage for free. Unlimited Displays, Companies and Users."},{type:"basic",productId:"289",pc:"40c092161f547f8f72c9f173cd8eebcb9ca5dd25"},{type:"advanced",productId:"290",pc:"93b5595f0d7e4c04a3baba1102ffaecb17607bf4"},{type:"enterprise",productId:"301",pc:"b1844725d63fde197f5125b58b6cba6260ee7a57"},{type:"enterprisesub",productId:"303",pc:"d521f5bfbc1eef109481eebb79831e11c7804ad8"}]).factory("planFactory",["$q","$log","$rootScope","$modal","$templateCache","userState","storeAPILoader","subscriptionStatusService","currencyService","PLANS_LIST",function(e,t,n,a,s,r,i,o,c,l){function d(){return c().then(function(e){var t=r.getCopyOfUserCompany(),n=t&&t.country?t.country:"";return e.getByCountry(n)})}function p(){r.getSelectedCompanyId()&&u.getCompanyPlan(r.getSelectedCompanyId()).then(function(e){u.currentPlan=e,t.debug("Current plan",e),n.$emit("risevision.plan.loaded",e)})["catch"](function(e){t.debug("Failed to load company's plan",e)})}var u={},m=_.map(l,"pc"),g=_.keyBy(l,"type"),v=_.keyBy(l,"pc");return u.getPlans=function(n){t.debug("getPlans called.");var a=e.defer();return i().then(function(e){e.product.list(n).execute(function(e){t.debug("getPlans response",e),e.error?a.reject(e.error):a.resolve(e)})}),a.promise},u.getPlansDetails=function(){t.debug("getPlansDetails called.");var n=e.defer(),a="(productTag=Plans)";return u.getPlans({search:a}).then(function(e){return t.debug("getPlansDetails response.",e),d().then(function(t){e.items.forEach(function(e){var n="per Company per Month",a=_.keyBy(e.pricing,"unit"),s=a[n]||{};e.type=e.name.toLowerCase().replace(" plan",""),e.priceMonth=t.pickPrice(s.priceUSD,s.priceCAD)});var a=_.keyBy(e.items,"type");n.resolve([_.cloneDeep(g.free),a.basic,a.advanced,a.enterprise])})})["catch"](function(e){n.reject(e)}),n.promise},u.getCompanyPlan=function(n){t.debug("getCompanyPlan called.");var a=e.defer();return o.list(m.slice(1),n).then(function(e){t.debug("getCompanyPlan response.",e);var n=_.cloneDeep(g.free),s=_.keyBy(e,"pc");m.forEach(function(e){var t=s[e];t&&["Subscribed","Suspended","On Trial"].indexOf(t.status)>=0&&(n=t)}),n.type=v[n.pc].type,a.resolve(n)})["catch"](function(e){a.reject(e)}),a.promise},u.showPlansModal=function(){a.open({template:s.get("plans/plans-modal.html"),controller:"PlansModalCtrl",size:"lg",resolve:{currentPlan:function(){return u.currentPlan}}})},p(),n.$on("risevision.company.selectedCompanyChanged",function(){p()}),u}])}(angular),angular.module("risevision.common.components.plans").controller("PlansDowngradeModalCtrl",["$scope","$modalInstance",function(e,t){e.dismiss=function(){t.dismiss("cancel")}}]),angular.module("risevision.common.components.plans").controller("PlansModalCtrl",["$scope","$modalInstance","$log","$modal","$templateCache","$loading","planFactory","currentPlan",function(e,t,n,a,s,r,i,o){e.currentPlan=o,e.getPlansDetails=function(){return r.start("plans-modal"),i.getPlansDetails().then(function(t){e.plans=t})["catch"](function(e){n.debug("Failed to load details",e)})["finally"](function(){r.stop("plans-modal")})},e.showDowngradeModal=function(){a.open({template:s.get("plans/plans-downgrade-modal.html"),controller:"PlansDowngradeModalCtrl",size:"md"})},e.canUpgrade=function(e){return o.type!==e.type&&("enterprise"!==o.type&&("advanced"===o.type&&"enterprise"===e.type||("basic"===o.type&&("advanced"===e.type||"enterprise"===e.type)||"free"===o.type)))},e.canDowngrade=function(e){return o.type!==e.type&&("enterprise"===o.type||("advanced"===o.type&&("free"===e.type||"basic"===e.type)||"basic"===o.type&&"free"===e.type))},e.dismiss=function(){t.dismiss("cancel")},e.getPlansDetails()}]),function(e){try{e=angular.module("risevision.common.components.plans")}catch(t){e=angular.module("risevision.common.components.plans",[])}e.run(["$templateCache",function(e){e.put("plans/plans-downgrade-modal.html",'<div><div class="modal-header"><button type="button" class="close" ng-click="dismiss()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 id="icpModalTitle" class="modal-title">Downgrade</h3></div><div class="modal-body u_padding-lg" stop-event="touchend"><div class="container-fluid text-center u_padding-lg">Downgrading an account needs to be processed through our Support team. Please reach out and we\'ll help!<br><a class="btn btn-primary btn-lg u_margin-lg-top" href="https://www.risevision.com/contact-us" target="_blank">Contact Us</a></div></div><div class="modal-footer"></div></div>')}])}(),function(e){try{e=angular.module("risevision.common.components.plans")}catch(t){e=angular.module("risevision.common.components.plans",[])}e.run(["$templateCache",function(e){e.put("plans/plans-modal.html",'<div rv-spinner="" rv-spinner-key="plans-modal" rv-spinner-start-active="1"><div class="modal-header"><button type="button" class="close" ng-click="dismiss()" aria-hidden="true"><i class="fa fa-times"></i></button><h3 class="modal-title">Choose Your Plan</h3></div><div id="plans-modal" class="modal-body u_padding-lg" stop-event="touchend"><div class="grid-list row"><div class="col-xs-12 col-sm-6 col-md-3"><div class="u_cursor_disabled panel panel-default"><div itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><div class="grid-list-text text-center u_margin-sm-top"><h4 id="productName">Free</h4><p class="product-description">Design, distribute and manage your digital signage for free. Unlimited Displays, Companies and Users.</p><div><h1>$0</h1>&nbsp;per Company per Month</div><a id="current-plan" target="_blank" class="cta_button btn btn-white u_margin-lg">Current Plan</a></div></div></div></div><div class="col-xs-12 col-sm-6 col-md-3"><div class="u_cursor_disabled panel panel-default"><div itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><div class="grid-list-text text-center u_margin-sm-top"><h4 id="productName">Basic</h4><p class="product-description">Great for small organizations with a couple of displays that need time saving templates and media hosting. Includes 2 Player Professional licences.</p><div><h1>$19</h1>&nbsp;per Company per Month</div><a id="subscribe-plan" target="_blank" href="https://store.risevision.com/product/{{plan.productId}}" class="cta_button btn btn-primary u_margin-lg">Start 14-Day Trial</a></div></div></div></div><div class="col-xs-12 col-sm-6 col-md-3"><div class="u_cursor_disabled panel panel-default panel-focus"><div itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><div class="grid-list-text text-center u_margin-sm-top"><h4 id="productName">Advanced</h4><p class="product-description">Ideal for organizations managing a small network of displays that want more scheduling options and priority support. Includes 9 Player Professional licences.</p><div><h1>$85</h1>&nbsp;per Company per Month</div><a id="subscribe-plan" target="_blank" href="https://store.risevision.com/product/{{plan.productId}}" class="cta_button btn btn-primary u_margin-lg">Subscribe</a></div></div></div></div><div class="col-xs-12 col-sm-6 col-md-3"><div class="u_cursor_disabled panel panel-default"><div itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><div class="grid-list-text text-center u_margin-sm-top"><h4 id="productName">Enterprise</h4><p class="product-description">Perfect for large institutions and businesses with multiple sites, departments and users managing many displays. Includes 50 Player Professional licences.</p><div><h1>$489</h1>&nbsp;per Company per Month</div><a id="subscribe-plan" target="_blank" href="https://store.risevision.com/product/{{plan.productId}}" class="cta_button btn btn-primary u_margin-lg">Subscribe</a></div></div></div></div></div><div class="text-center u_margin-md-top"><a class="btn btn-link btn-lg get-started-guide" target="_blank" href="https://www.risevision.com/pricing?utm_campaign=apps">Learn More About Our Plan Pricing</a> <span class="bold">OR</span> <a class="btn btn-link btn-lg get-started-guide" target="_blank" href="https://www.risevision.com/contact-us">Contact Sales If You Need Help</a></div></div><div class="modal-footer"></div></div>')}])}();