"use strict";var gapiLoadingStatus=null,handleClientJSLoad=function(){gapiLoadingStatus="loaded",console.debug("ClientJS is loaded.");var e=document.createEvent("Events");e.initEvent("gapi.loaded",!0,!0),window.dispatchEvent(e)};angular.module("risevision.common.gapi",["risevision.common.components.util"]).value("CLIENT_ID","614513768474.apps.googleusercontent.com").value("OAUTH2_SCOPES","profile").factory("gapiLoader",["$q","$window",function(e,r){var a=e.defer();return function(){var e;if("loaded"===r.gapiLoadingStatus)a.resolve(r.gapi);else if(!r.gapiLoadingStatus){r.gapiLoadingStatus="loading";var t=r.gapiSrc||"//apis.google.com/js/client.js?onload=handleClientJSLoad",o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",t),"undefined"!=typeof o&&document.getElementsByTagName("body")[0].appendChild(o),e=function(){a.resolve(r.gapi),r.removeEventListener("gapi.loaded",e,!1)},r.addEventListener("gapi.loaded",e,!1)}return a.promise}}]).factory("auth2APILoader",["$q","$log","$location","$window","gapiLoader","getBaseDomain","CLIENT_ID","OAUTH2_SCOPES",function(e,r,a,t,o,n,i,c){return function(){var u=e.defer();return o().then(function(e){e.auth2&&e.auth2.getAuthInstance()?u.resolve(e.auth2):e.load("auth2",function(){if(e.auth2)e.auth2.init({client_id:i,scope:c,cookie_policy:a.protocol()+"://"+n()+(t.location.port?":"+t.location.port:"")}).then(function(){r.debug("auth2 API Loaded"),u.resolve(e.auth2)},function(){var e="auth2 GoogleAuth Init Failed";r.error(e),u.reject(e)});else{var o="auth2 API Load Failed";r.error(o),u.reject(o)}})}),u.promise}}]).factory("clientAPILoader",["$q","$log","gapiLoader",function(e,r,a){return function(){var t=e.defer();return a().then(function(e){e.client?t.resolve(e):e.load("client",function(){if(e.client)r.debug("client API Loaded"),t.resolve(e);else{var a="client API Load Failed";r.error(a),t.reject(a)}})}),t.promise}}]).factory("gapiClientLoaderGenerator",["$q","$log","$timeout","$http","clientAPILoader",function(e,r,a,t,o){return function(n,i,c){var u=!1;return function(){var l=e.defer();return o().then(function(e){var o;e.client[n]?(u=!0,l.resolve(e.client[n])):(e.client.load(n,i,function(){if(u=!0,o&&a.cancel(o),e.client[n])r.debug(n+"."+i+" Loaded"),l.resolve(e.client[n]);else{var t=n+"."+i+" Load Failed";r.error(t),l.reject(t)}},c),u||(o=a(function(){u=!0,c&&!e.client[n]&&t({url:c,method:"GET"})["catch"](function(e){if(e&&404!==e.status&&(e.status<200||e.status>=400)){var a=n+" ("+c+") failed to respond";r.error(a,e),l.reject({status:-1,result:{error:{code:-1,message:a,error:e}}})}})},1e4)))}),l.promise}}}]).factory("oauth2APILoader",["gapiClientLoaderGenerator",function(e){return e("oauth2","v2")}]).factory("coreAPILoader",["CORE_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().core_api_base_url?a.search().core_api_base_url+"/_ah/api":e;return r("core","v1",t)}]).factory("riseAPILoader",["CORE_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().core_api_base_url?a.search().core_api_base_url+"/_ah/api":e;return r("rise","v0",t)}]).factory("storeAPILoader",["STORE_ENDPOINT_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().store_api_base_url?a.search().store_api_base_url+"/_ah/api":e;return r("store","v0.01",t)}]).factory("storageAPILoader",["STORAGE_ENDPOINT_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().storage_api_base_url?a.search().storage_api_base_url+"/_ah/api":e;return r("storage","v0.02",t)}]).factory("discoveryAPILoader",["CORE_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().core_api_base_url?a.search().core_api_base_url+"/_ah/api":e;return r("discovery","v1",t)}]).factory("monitoringAPILoader",["MONITORING_SERVICE_URL","gapiClientLoaderGenerator","$location",function(e,r,a){var t=a.search().core_api_base_url?a.search().core_api_base_url+"/_ah/api":e;return r("monitoring","v0",t)}]),function(e){e.module("risevision.common.components.util",[]).value("humanReadableError",function(e){var r;return r=e.message?e.message:e.error?e.error.message?e.error.message:e.error:e,JSON.stringify(r)}).factory("dateIsInRange",[function(){return function(e,r,a){var t,o,n=!0;try{r&&(t=r.match(/(\d{4})\-(\d{2})\-(\d{2})/),o=new Date(t[1],parseInt(t[2])-1,t[3],0,0,0,0),n=e>=o),n&&a&&(t=a.match(/(\d{4})\-(\d{2})\-(\d{2})/),o=new Date(t[1],parseInt(t[2])-1,t[3],0,0,0,0),n=e<=o)}catch(i){n=!1}return n}}]).factory("objectHelper",[function(){var r={};return r.follow=function(e){var r=function(){};return r.prototype=e,new r},r.clearObj=function(e){for(var r in e)delete e[r]},r.clearAndCopy=function(a,t){r.clearObj(t),e.extend(t,a)},r}]).factory("getBaseDomain",["$log","$location",function(e,r){var a=function(e){return!!/^([0-9])+\.([0-9])+\.([0-9])+\.([0-9])+$/.test(e)};return function(){var t;if(!t){var o=r.host();if(a(o))t=o;else{var n=o.split(".");t=n.length>1?"appspot"===n[n.length-2]?n.slice(n.length-3).join("."):n.slice(n.length-2).join("."):o}e.debug("baseDomain",t)}return t}}])}(angular);