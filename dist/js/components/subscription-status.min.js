!function(){"use strict";try{angular.module("risevision.common.config")}catch(s){angular.module("risevision.common.config",[])}angular.module("risevision.common.config").value("STORE_URL","https://store.risevision.com/").value("STORE_SERVER_URL","https://store-dot-rvaserver2.appspot.com/"),angular.module("risevision.common.components.subscription-status.config",[]).value("IN_RVA_PATH","product/productId/?cid=companyId").value("ACCOUNT_PATH","account?cid=companyId").value("PATH_URL","v1/company/companyId/product/status?pc=").value("AUTH_PATH_URL","v1/widget/auth?cid=companyId&pc=").value("PATH_URL_BY_DISPLAY_ID","v1/product/productCode/status?displayIds="),angular.module("risevision.common.components.subscription-status.filters",["risevision.common.i18n"]),angular.module("risevision.common.components.subscription-status.directives",["risevision.common.components.subscription-status.service"]),angular.module("risevision.common.components.subscription-status",["ngSanitize","ui.bootstrap","risevision.common.config","risevision.common.components.subscription-status.config","risevision.common.components.subscription-status.directives","risevision.common.components.subscription-status.filters","risevision.common.components.subscription-status.service"])}(),function(){"use strict";angular.module("risevision.common.components.subscription-status.service",["risevision.common.config","risevision.common.components.subscription-status.config"]).service("subscriptionStatusService",["$http","$q","STORE_SERVER_URL","PATH_URL","AUTH_PATH_URL","PATH_URL_BY_DISPLAY_ID",function(s,t,n,i,a,o){function e(s,t){return Math.floor((t.getTime()-s.getTime())/u)}var r=["On Trial","Trial Expired","Subscribed","Suspended","Cancelled","Free","Not Subscribed","Product Not Found","Company Not Found","Error"],u=864e5,c=function(i,o){var e=t.defer(),r=n+a.replace("companyId",o)+i;return s.get(r).then(function(s){s&&s.data?e.resolve(s.data.authorized):e.resolve(!1)}),e.promise},p=function(a,u,c){var p=t.defer();a=Array.isArray(a)?a:[a];var l=n+i.replace("companyId",u)+a.join(",");return c&&(l=n+o.replace("productCode",a.join(","))+c),s.get(l).then(function(s){if(s&&s.data&&s.data.length){for(var t=[],n=0;n<s.data.length;n++){var i=s.data[n];t.push(i),i.plural="",i.statusCode=i.status.toLowerCase().replace(" ","-"),""===i.status?(i.status="N/A",i.statusCode="na",i.subscribed=!1):i.status===r[0]||i.status===r[2]||i.status===r[5]?i.subscribed=!0:i.subscribed=!1,"not-subscribed"===i.statusCode&&i.trialPeriod&&i.trialPeriod>0&&(i.statusCode="trial-available",i.subscribed=!0),i.expiry&&"on-trial"===i.statusCode&&(i.expiry=new Date(i.expiry),i.expiry instanceof Date&&!isNaN(i.expiry.valueOf())&&(i.expiry=e(new Date,i.expiry)),0===i.expiry?i.plural="-zero":i.expiry>1&&(i.plural="-many"))}p.resolve(t)}else p.reject("No response")}),p.promise};this.get=function(s,t,n){return p(s,t,n).then(function(n){var i=n[0];return i.subscribed===!1?c(s,t).then(function(s){return i.subscribed=s,i}):i})},this.list=function(s,t,n){return p(s,t,n)}}])}(),function(){"use strict";angular.module("risevision.common.components.subscription-status.directives").directive("subscriptionStatus",["$rootScope","$templateCache","subscriptionStatusService","STORE_URL","ACCOUNT_PATH","IN_RVA_PATH",function(s,t,n,i,a,o){return{restrict:"AE",require:"?ngModel",scope:{productId:"@",productCode:"@",companyId:"@",displayId:"@",expandedFormat:"@",showStoreModal:"=?",customProductLink:"@",customOnClick:"&"},template:t.get("subscription-status/subscription-status-template.html"),link:function(t,e,r,u){function c(){t.productCode&&t.productId&&(t.companyId||t.displayId)&&n.get(t.productCode,t.companyId,t.displayId).then(function(n){n&&(t.subscriptionStatus&&t.subscriptionStatus.status===n.status||s.$emit("subscription-status:changed",n),t.subscriptionStatus=n)},function(s){console.log("Error checking subscription status",s)})}t.subscriptionStatus={status:"N/A",statusCode:"na",subscribed:!1,expiry:null};var p=function(){t.storeAccountUrl=i+a.replace("companyId",t.companyId),t.customProductLink?t.storeUrl=t.customProductLink:t.storeUrl=i+o.replace("productId",t.productId).replace("companyId",t.companyId)};t.$watch("companyId",function(){c(),p()});var l=s.$on("refreshSubscriptionStatus",function(s,n){null!==n&&t.subscriptionStatus.statusCode!==n||c()});t.$on("$destroy",function(){l()}),u&&t.$watch("subscriptionStatus",function(s){u.$setViewValue(s)})}}}]).filter("to_trusted",["$sce",function(s){return function(t){return s.trustAsHtml(t)}}])}(),angular.module("risevision.common.components.subscription-status.filters").filter("productTrialDaysToExpiry",["$interpolate","$translate",function(s,t){var n=null,i=null;return t(["subscription-status.expires-today","subscription-status.expires-in"],{days:"{{days}}"}).then(function(t){n=s(t["subscription-status.expires-today"]),i=s(t["subscription-status.expires-in"])}),function(s){var t="";try{var a=864e5,o=new Date(s).getTime()-(new Date).getTime(),e=Math.floor(o/a),r={days:e};t=0===e?null!==n?n(r):"":e>0?null!==i?i(r):"":null!==n?n(r):""}catch(u){}return t}}]),function(s){try{s=angular.module("risevision.common.components.subscription-status")}catch(t){s=angular.module("risevision.common.components.subscription-status",[])}s.run(["$templateCache",function(s){s.put("subscription-status/subscription-status-template.html",'<div ng-show="!expandedFormat"><h3 ng-disable-right-click=""><span ng-show="subscriptionStatus.statusCode !== \'not-subscribed\'" ng-bind-html="\'subscription-status.\' + subscriptionStatus.statusCode + subscriptionStatus.plural | translate:subscriptionStatus | to_trusted"></span></h3><span ng-show="subscriptionStatus.statusCode === \'trial-available\'"><button class="btn btn-primary btn-xs" ng-click="showStoreModal = true;"><span translate="subscription-status.start-trial"></span></button></span> <span ng-show="[\'on-trial\', \'trial-expired\', \'cancelled\', \'not-subscribed\'].indexOf(subscriptionStatus.statusCode) >= 0"><a class="btn btn-primary btn-xs" ng-href="{{storeUrl}}" target="_blank" ng-show="!customOnClick"><span translate="subscription-status.subscribe"></span></a> <a class="btn btn-primary btn-xs" ng-click="customOnClick()" ng-show="customOnClick"><span translate="subscription-status.subscribe"></span></a></span> <span ng-show="[\'suspended\'].indexOf(subscriptionStatus.statusCode) >= 0"><a type="button" class="btn btn-primary btn-xs" ng-href="{{storeAccountUrl}}" target="_blank"><span translate="subscription-status.view-account"></span></a></span></div><div ng-show="expandedFormat"><div class="subscription-status trial" ng-show="subscriptionStatus.statusCode === \'on-trial\'"><span ng-bind-html="\'subscription-status.expanded-\' + subscriptionStatus.statusCode + subscriptionStatus.plural | translate:subscriptionStatus | to_trusted"></span> <a type="button" class="btn btn-primary u_margin-left" ng-href="{{storeUrl}}" target="_blank" ng-show="!customOnClick"><span translate="subscription-status.subscribe-now"></span></a> <a type="button" class="btn btn-primary u_margin-left" ng-click="customOnClick()" ng-show="customOnClick"><span translate="subscription-status.subscribe-now"></span></a></div><div class="subscription-status expired" ng-show="subscriptionStatus.statusCode === \'trial-expired\'"><span translate="subscription-status.expanded-expired"></span> <a type="button" class="btn btn-primary u_margin-left" ng-href="{{storeUrl}}" target="_blank" ng-show="!customOnClick"><span translate="subscription-status.subscribe-now"></span></a> <a type="button" class="btn btn-primary u_margin-left" ng-click="customOnClick()" ng-show="customOnClick"><span translate="subscription-status.subscribe-now"></span></a></div><div class="subscription-status cancelled" ng-show="subscriptionStatus.statusCode === \'cancelled\' && !subscriptionStatus.subscribed"><span translate="subscription-status.expanded-cancelled"></span> <a type="button" class="btn btn-primary u_margin-left" ng-href="{{storeUrl}}" target="_blank" ng-show="!customOnClick"><span translate="subscription-status.subscribe-now"></span></a> <a type="button" class="btn btn-primary u_margin-left" ng-click="customOnClick()" ng-show="customOnClick"><span translate="subscription-status.subscribe-now"></span></a></div><div class="subscription-status suspended" ng-show="subscriptionStatus.statusCode === \'suspended\'"><span translate="subscription-status.expanded-suspended"></span> <a type="button" class="btn btn-primary u_margin-left" ng-href="{{storeAccountUrl}}" target="_blank"><span translate="subscription-status.view-invoices"></span></a></div></div>')}])}();